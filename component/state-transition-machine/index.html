<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://www.elcodi.io/component/state-transition-machine/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>State transition machine - Elcodi Documentation</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <link href="../../css/elcodi.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../.."><img src="../../img/elcodi.png" height="30" /></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                
                
                
                    
                        <li >
                            <a href="../../quick-start/">Quick start</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Book <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
<li >
    <a href="../../book/cart-architecture/">Cart architecture</a>
</li>

                            
                                
<li >
    <a href="../../book/category-architecture/">Category architecture</a>
</li>

                            
                                
<li >
    <a href="../../book/coupon-architecture/">Coupon architecture</a>
</li>

                            
                                
<li >
    <a href="../../book/dictionary/">Dictionary</a>
</li>

                            
                                
<li >
    <a href="../../book/emails/">Emails</a>
</li>

                            
                                
<li >
    <a href="../../book/events/">Events</a>
</li>

                            
                                
<li >
    <a href="../../book/">Home</a>
</li>

                            
                                
<li >
    <a href="../../book/payments/">Payments</a>
</li>

                            
                                
<li >
    <a href="../../book/philosophy/">Philosophy</a>
</li>

                            
                                
<li >
    <a href="../../book/plugins/">Plugins</a>
</li>

                            
                                
<li >
    <a href="../../book/processes/">Processes</a>
</li>

                            
                                
<li >
    <a href="../../book/product-architecture/">Product architecture</a>
</li>

                            
                                
<li >
    <a href="../../book/pull-requests/">Pull requests</a>
</li>

                            
                                
<li >
    <a href="../../book/roadmap/">Roadmap</a>
</li>

                            
                                
<li >
    <a href="../../book/running-test-suite/">Running test suite</a>
</li>

                            
                                
<li >
    <a href="../../book/shipping/">Shipping</a>
</li>

                            
                                
<li >
    <a href="../../book/standards/">Standards</a>
</li>

                            
                                
<li >
    <a href="../../book/what-is-elcodi/">What is elcodi</a>
</li>

                            
                                
<li >
    <a href="../../book/why-elcodi/">Why elcodi</a>
</li>

                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
<li >
    <a href="../../cookbook/">Home</a>
</li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Installation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../cookbook/installation/install-a-plugin/">Install a plugin</a>
</li>

        
            
<li >
    <a href="../../cookbook/installation/install-dependent-bundles/">Install dependent bundles</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Overwrite</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../cookbook/overwrite/overwrite-a-parameter/">Overwrite a parameter</a>
</li>

        
            
<li >
    <a href="../../cookbook/overwrite/overwrite-a-service/">Overwrite a service</a>
</li>

        
            
<li >
    <a href="../../cookbook/overwrite/overwrite-an-entity/">Overwrite an entity</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Deprecation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../cookbook/deprecation/deprecate-a-method/">Deprecate a method</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Adapters</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../cookbook/adapters/currency-rates-populator/">Currency rates populator</a>
</li>

        
            
<li >
    <a href="../../cookbook/adapters/image-resize/">Image resize</a>
</li>

        
            
<li >
    <a href="../../cookbook/adapters/location-provider/">Location provider</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Workflow</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../cookbook/workflow/create-automatic-coupon/">Create automatic coupon</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Implementation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../cookbook/implementation/implement-a-collector/">Implement a collector</a>
</li>

        
            
<li >
    <a href="../../cookbook/implementation/implement-a-controller-and-a-command/">Implement a controller and a command</a>
</li>

        
            
<li >
    <a href="../../cookbook/implementation/implement-a-factory/">Implement a factory</a>
</li>

        
            
<li >
    <a href="../../cookbook/implementation/implement-a-form-type/">Implement a form type</a>
</li>

        
            
<li >
    <a href="../../cookbook/implementation/implement-a-repository/">Implement a repository</a>
</li>

        
            
<li >
    <a href="../../cookbook/implementation/implement-an-entity/">Implement an entity</a>
</li>

        
            
<li >
    <a href="../../cookbook/implementation/implement-an-event-listener/">Implement an event listener</a>
</li>

        
    </ul>
  </li>

                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Component <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
<li >
    <a href="../entity-translator/">Entity translator</a>
</li>

                            
                                
<li >
    <a href="../">Home</a>
</li>

                            
                                
<li >
    <a href="../media/">Media</a>
</li>

                            
                                
<li >
    <a href="../menu/">Menu</a>
</li>

                            
                                
<li >
    <a href="../sitemap/">Sitemap</a>
</li>

                            
                                
<li class="active">
    <a href="./">State transition machine</a>
</li>

                            
                                
<li >
    <a href="../template/">Template</a>
</li>

                            
                            </ul>
                        </li>
                    
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../sitemap/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../template/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/elcodi/docs">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#state-transition-machine">State Transition Machine</a></li>
        
            <li><a href="#what-offers">What offers</a></li>
        
            <li><a href="#usage">Usage</a></li>
        
            <li><a href="#machine-builder">Machine Builder</a></li>
        
            <li><a href="#machine">Machine</a></li>
        
            <li><a href="#machine-manager">Machine Manager</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="state-transition-machine">State Transition Machine<a class="headerlink" href="#state-transition-machine" title="Permanent link"> #</a></h1>
<p>Add states in your entities.</p>
<ul>
<li><a href="https://github.com/elcodi/StateTransitionMachine">Component Repository</a></li>
<li><a href="https://github.com/elcodi/StateTransitionMachineBundle">Bundle Repository</a></li>
</ul>
<p>Can your entity change its states? This component will help you to implement 
this in a very decoupled way, providing you a very simple way for definition of
these states and a very easy way of managing them.</p>
<h2 id="what-offers">What offers<a class="headerlink" href="#what-offers" title="Permanent link"> #</a></h2>
<p>Offers all the transition machine model classes, as well as all the service 
layer for it management, or a complete set of events dispatched during all 
transitions between states.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link"> #</a></h2>
<p>This component provides you a State Transition Machine for your entities. To
understand what is a State Transition Machine, let's see an example about a use
case.</p>
<p>Let's figure out we are working with a Order object. We want to give some states
to this Order, like "new", "paid" and "shipped". Well, this is the perfect
scenario for this component. The only thing you must define is the set of states
and how you should jump from one to another.</p>
<p>Let's see an example.</p>
<pre><code class="php">$configuration = [
    'new', 'pay', 'paid',
    'paid', 'ship', 'shipped',
    'shipped', 'receive', 'received',
];
</code></pre>

<p>You have four states here.
<em> new: First state or point of entry
</em> paid: The order is paid
<em> shipped: The order is shipped but is not received yet
</em> received: The order is received</p>
<p>And we have three transitions between these states.
<em> pay: We pay an order
</em> ship: We ship an order
* receive: A ship is being received</p>
<h2 id="machine-builder">Machine Builder<a class="headerlink" href="#machine-builder" title="Permanent link"> #</a></h2>
<p>So, this component provides a way to play with all this information in a very
single way, providing as well one machine for each configuration, identified by
a string. Let's see an example of how to build a useful Machine for our project.</p>
<pre><code class="php">&lt;?php

use Elcodi\Component\StateTransitionMachine\Factory\MachineFactor;

$machineIdentifier = 'order_states';
$pointOfEntry = 'new';
$machineFactory = new MachineFactory;
$configuration = [
    'new', 'pay', 'paid',
    'paid', 'ship', 'shipped',
    'shipped', 'receive', 'received',
];

$machineBuilder = new MachineBuilder(
    $machineFactory,
    $machineIdentifier,
    $configuration,
    $pointOfEntry
);
$machine = $machineBuilder-&gt;compile();
</code></pre>

<p>To build a MachineCompiler we need this information:
<em> Machine Factory: The factory that the MachineBuilder will use to build a new
Machine instance
</em> Machine identifier: The identifier of the machine. This value must be unique
<em> Configuration: The states definition. This parameter must be an array of
edges, and each edge must be an array with this elements: <code>from state</code>,
<code>transition name</code> and <code>to state</code>.
</em> Point of Entry: The first state to add once the object is initialized</p>
<h2 id="machine">Machine<a class="headerlink" href="#machine" title="Permanent link"> #</a></h2>
<p>Once the MachineBuilder is compiled, this method returns us a MachineInterface
implementation, with the possibility of using 4 methods.</p>
<pre><code class="php">    /**
     * Get machine id
     *
     * @return string Machine identifier
     */
    public function getId();

    /**
     * Get point of entry
     *
     * @return string Point of entry
     */
    public function getPointOfEntry();

    /**
     * Applies a transition from a state
     *
     * @param string $startStateName Start state name
     * @param string $transitionName Transition name
     *
     * @return Transition Transition created
     *
     * @throws TransitionNotAccessibleException Transition not accessible
     * @throws TransitionNotValidException      Invalid transition name
     */
    public function transition(
        $startStateName,
        $transitionName
    );

    /**
     * Reaches a state given a start state
     *
     * @param string $startStateName Start state name
     * @param string $finalStateName Final state name
     *
     * @return Transition Transition created
     *
     * @throws StateNotReachableException State is not reachable
     */
    public function reachState(
        $startStateName,
        $finalStateName
    );
</code></pre>

<p>Given the last example with the last configuration, lets try to do apply the
<code>pay</code> transition from the <code>new</code> state using the <code>transition</code> method.</p>
<pre><code class="php">echo $machine-&gt;getId();
// = order_states

echo $machine-&gt;getPointOfEntry();
// = new

$transition = $machine-&gt;transition('unpaid', 'pay');
echo get_class($transition);
// = \Elcodi\Component\StateTransitionMachine\Definition\Transition

echo $transition-&gt;getName();
// = pay

echo $transition-&gt;getStart()-&gt;getName();
// = new

echo $transition-&gt;getFinal()-&gt;getName();
// = paid
</code></pre>

<p>We can use the <code>reachState</code> method as well, to reach an specific state no matter
the name of the transition. The result should be the same as the last example.</p>
<pre><code class="php">$transition = $machine-&gt;reachState('new', 'paid');
</code></pre>

<p>Because using a machine is a transactional action, all errors will be notified
with Exceptions. In that case, because we can not <code>ship</code> an <code>new</code> order, we
would receive a <code>TransitionNotAccessibleException</code> exception.</p>
<pre><code class="php">$transition = $machine-&gt;transition('new', 'ship');
</code></pre>

<h2 id="machine-manager">Machine Manager<a class="headerlink" href="#machine-manager" title="Permanent link"> #</a></h2>
<p>To make things easier and to provide a nice interface for the final user, a
<code>MachineManager</code> object is created. This object provide as well a nice interface
to dispatch events using the Symfony Event Dispatcher Component.</p>
<p>Let's see how it works using the previous Machine object. To make it happen, we
must work with implementations of the interface
<code>\Elcodi\Component\StateTransitionMachine\Entity\Interfaces\StatefulInterface</code>,
so our <code>Order</code> instance is one of these.</p>
<p>Every entity implementing this interface, in order to be able to work with an
specific machine, must be initialized once to make sure that the first state is
already injected. Once this object is initialized, this action is not required
anymore.</p>
<pre><code class="php">$stateLineFactory = new StateLineFactory();
$eventDispatcher = new EventDispatcher();
$machineManager = new MachineManager(
    $machine,
    $eventDispatcher,
    $stateLineFactory,
);

$order = new Order();
$machineManager-&gt;initialize($order, 'First state');
$transition = $machineManager-&gt;reachState($order, 'paid', 'The order have been
paid');
</code></pre>

<p>Because the point of entry state is <code>new</code> and we can reach the State <code>paid</code>,
this transition will be valid.
In this action, several events will be dispatched from the $eventDispatched
instance.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright © 2014/2015 <a href="http://www.elcodi.io">Elcodi</a>. All rights reserved.</p>
            
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
