<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>entityTranslator - Elcodi Documentation</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Elcodi Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../quick-start/">Quick start</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../reference/attribute/">Attribute</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/banner/">Banner</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/cart-coupon/">Cart coupon</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/cart/">Cart</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/comment/">Comment</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/configuration/">Configuration</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/coupon/">Coupon</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/">Home</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/sitemap/">Sitemap</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Components <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li class="active">
                                <a href="./">entityTranslator</a>
                            </li>
                        
                            <li >
                                <a href="../">Home</a>
                            </li>
                        
                            <li >
                                <a href="../sitemap/">Sitemap</a>
                            </li>
                        
                            <li >
                                <a href="../stateTransitionMachine/">stateTransitionMachine</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Book <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../book/">Home</a>
                            </li>
                        
                            <li >
                                <a href="../../book/standards/classes/">Classes</a>
                            </li>
                        
                            <li >
                                <a href="../../book/standards/code/">Code</a>
                            </li>
                        
                            <li >
                                <a href="../../book/standards/dependency-injection/">Dependency injection</a>
                            </li>
                        
                            <li >
                                <a href="../../book/standards/packages-structure/">Packages structure</a>
                            </li>
                        
                            <li >
                                <a href="../../book/workflows/cart/">Cart</a>
                            </li>
                        
                            <li >
                                <a href="../../book/bundles/extensions/">Extensions</a>
                            </li>
                        
                            <li >
                                <a href="../../book/philosophy/elcodi/">Elcodi</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../cookbook/">Home</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/caveats/test-suite/">Test suite</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/installation/dependent-bundles/">Dependent bundles</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/overwrite/entity/">Entity</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/overwrite/parameter/">Parameter</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/overwrite/service/">Service</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/implementation/controller-command/">Controller command</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/implementation/entity/">Entity</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/implementation/factory/">Factory</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/implementation/form-type/">Form type</a>
                            </li>
                        
                            <li >
                                <a href="../../cookbook/implementation/repository/">Repository</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../../reference/sitemap/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#entitytranslator">EntityTranslator</a></li>
        
            <li><a href="#entitytranslator-component">EntityTranslator Component</a></li>
        
            <li><a href="#entitytranslator-bundle">EntityTranslator Bundle</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="entitytranslator">EntityTranslator</h1>
<p>Translate your entities in a very and smart decoupled way. Your model definition 
will not change and you will be able to place your translations in another
database.</p>
<h2 id="entitytranslator-component">EntityTranslator Component</h2>
<p>The EntityTranslator Component will translate your entities in a very decoupled
way, in order to maintain your original model as much invariable as possible, 
not depending on your translation needs.</p>
<p>The model is the most important part of a project, right? We strongly believe
that, so we think that coupling the entities with the translation infrastructure
is a bad practice.</p>
<p>This component provides an external translation engine with some nice services
to make an entity translation something really easy and enjoyable.</p>
<p>Let's figure out we are working with a Product object. Our model clean, with two
fields: name and description. All this documentation assumes the usage of this
class.</p>
<pre><code class="php">/**
 * Class Product
 */
class Product
{
    /**
     * @var string
     *
     * id
     */
    protected $id;

    /**
     * @var string
     *
     * Name
     */
    protected $name;

    /**
     * @var string
     *
     * Description
     */
    protected $description;

    /**
     * Get Id
     *
     * @return string Id
     */
    public function getId()
    {
        return $this-&gt;id;
    }

    /**
     * Sets Id
     *
     * @param string $id Id
     *
     * @return $this Self object
     */
    public function setId($id)
    {
        $this-&gt;id = $id;

        return $this;
    }

    /**
     * Get Name
     *
     * @return mixed Name
     */
    public function getName()
    {
        return $this-&gt;name;
    }

    /**
     * Sets Name
     *
     * @param mixed $name Name
     *
     * @return $this Self object
     */
    public function setName($name)
    {
        $this-&gt;name = $name;

        return $this;
    }

    /**
     * Get Description
     *
     * @return string Description
     */
    public function getDescription()
    {
        return $this-&gt;description;
    }

    /**
     * Sets Description
     *
     * @param string $description Description
     *
     * @return $this Self object
     */
    public function setDescription($description)
    {
        $this-&gt;description = $description;

        return $this;
    }
}
</code></pre>

<p>We want to manage the translations of both properties. Important, each project
needs to define what fields must be translatable, this is not related to the
component itself.</p>
<h3 id="entitytranslationprovider">EntityTranslationProvider</h3>
<p>The translation provider is responsible to connect with the persistent layer and
provide the results, using an specific format, to the managers and services.</p>
<pre><code class="php">/**
 * Interface EntityTranslationProviderInterface
 */
interface EntityTranslationProviderInterface
{
    /**
     * Get translation
     *
     * @param string $entityType  Type of entity
     * @param string $entityId    Id of entity
     * @param string $entityField Field of entity
     * @param string $locale      Locale
     *
     * @return string Value fetched
     */
    public function getTranslation(
        $entityType,
        $entityId,
        $entityField,
        $locale
    );

    /**
     * Set translation
     *
     * @param string $entityType       Type of entity
     * @param string $entityId         Id of entity
     * @param string $entityField      Field of entity
     * @param string $translationValue Translated value
     * @param string $locale           Locale
     *
     * @return string Value fetched
     */
    public function setTranslation(
        $entityType,
        $entityId,
        $entityField,
        $translationValue,
        $locale
    );

    /**
     * Flush all previously set translations.
     *
     * @return $this self Object
     */
    public function flushTranslations();
}
</code></pre>

<p>There is the possibility of using specific providers for some specific
decorations, for example, the <code>CachedEntityTranslationProvider</code> implementation,
that decorates the main provider by adding an extra cache layer.</p>
<h3 id="entitytranslatorbuilder">EntityTranslatorBuilder</h3>
<p>Translation configuration is not set on the fly. It means that a Translator
needs to know what entities and what fields must take in account for
translations.</p>
<p>For that reason we need to build the translator using a TranslatorBuilder.</p>
<pre><code class="php">$entityTranslationProvider;
$entityTranslatorFactory = new TranslatorFactory();
$entityTranslator = $this-&gt;getMock('Elcodi\Component\EntityTranslator\Services\EntityTranslator', array(), array(), '', false);

$configuration = array(
    'Elcodi\Component\EntityTranslator\Tests\Fixtures\TranslatableProduct' =&gt; array(
        'alias'  =&gt; 'product',
        'idGetter' =&gt; 'getId',
        'fields' =&gt; array(
            'name' =&gt; array(
                'setter' =&gt; 'setName',
                'getter' =&gt; 'getName',
            )
        )
    ),
);

$entityTranslatorBuilder = new EntityTranslatorBuilder(
    $entityTranslationProvider,
    $translatorFactory,
    $configuration
);
$entityTranslator = $translatorBuilder-&gt;compile();
</code></pre>

<p>A compiled translator is, somehow, an immutable object. This means that,
internally, can change because of new instances, but externally can only be
accessed by getters.</p>
<h3 id="entitytranslator_1">EntityTranslator</h3>
<p>The translator itself. This implementation enables you to work with entities
instead of translations.</p>
<pre><code class="php">/**
 * Interface EntityTranslatorInterface
 */
interface EntityTranslatorInterface
{
    /**
     * Translate object
     *
     * @param Object $object Object
     * @param string $locale Locale to be translated
     */
    public function translate($object, $locale);

    /**
     * Saves object translations
     *
     * @param Object $object       Object
     * @param array  $translations Translations
     */
    public function save($object, array $translations);
}
</code></pre>

<p>Using the same configuration than before, lets see an example about how we can
manage our entity translations using this service.</p>
<pre><code class="php">$product = new TranslatableProduct();
$product
    -&gt;setId(1)
    -&gt;setName('productName');

$entityTranslator-&gt;save($product, array(
    'es' =&gt; array(
        'name' =&gt; 'el nombre',
        'description' =&gt; 'la descripción',
    ),
    'en' =&gt; array(
        'name' =&gt; 'the name',
        'description' =&gt; 'the description',
        'anotherfield' =&gt; 'some value',
    ),
));

/**
 * At this point, all the data have been persisted to database and cached.
 * As you can see, the `translate` method returns the translated object, but
 * both objects are the same
 */

$translatedProduct = $translator-&gt;translate($product, 'en');

$translatedName = $translatedProduct-&gt;getName();
echo $translatedName;
// = &quot;the name&quot;

/**
 * So because both object are the same, you can just apply the translation
 * without using the returned object
 */

$translator-&gt;translate($product, 'es');

$translatedName = $product-&gt;getName();
echo $translatedName;
// = &quot;el nombre&quot;

</code></pre>

<p>To when you save all the translations of an entity, the <code>EntityTranslator</code> will
make a unique flush to the persistence layer, in order to improve this action.</p>
<h2 id="entitytranslator-bundle">EntityTranslator Bundle</h2>
<p>This Bundle provides a Entity Translation layer to your project, in order to
make your entities translatable respecting the integrity of your domain.</p>
<p>For that, this implementation hides all the translation model behind a soft
layer, so your business model is never modified because of the translation
needs.</p>
<h3 id="about-your-model">About your model</h3>
<p>Easy and simple. Let's work with a simple entity mapped in Doctrine.</p>
<pre><code class="php">/**
 * Class Product
 *
 * @ORM\Entity
 */
class Product
{
    /**
     * @var string
     *
     * @ORM\Id
     * @ORM\Column
     * @ORM\GeneratedValue
     *
     * id
     */
    protected $id;

    /**
     * @var string
     *
     * @ORM\Column(type=&quot;string&quot;)
     *
     * Name
     */
    protected $name;

    /**
     * @var string
     *
     * @ORM\Column(type=&quot;text&quot;)
     *
     * Description
     */
    protected $description;
}
</code></pre>

<p>This example will assume that you want to make both fields, name and
description, translatable. To make it happen, we can simply remove  the mapping
of both fields, to rely the responsibility of translation to the Translator
component.</p>
<pre><code class="php">/**
 * Class Product
 *
 * @ORM\Entity
 */
class Product
{
    /**
     * @var string
     *
     * @ORM\Id
     * @ORM\Column
     * @ORM\GeneratedValue
     *
     * id
     */
    protected $id;

    /**
     * @var string
     *
     * Name
     */
    protected $name;

    /**
     * @var string
     *
     * Description
     */
    protected $description;
}
</code></pre>

<p>Now your installation will see the Product as a simple id. Why is this good for
us? This example uses Annotations, and we highly recommend to define all your
mapping configuration using <code>yml</code> so you can easily decouple your model
implementation (entities) and your mapping configuration (Product.orm.yml) and
disable some fields for mapping with the same entity implementation.</p>
<h3 id="configuring-the-entity-translator">Configuring the entity translator</h3>
<p>Now, we need to configure the translator. You need to define what entities and
fields you allow the engine to manage. Let's see the configuration for this
example.</p>
<pre><code class="yml">elcodi_entity_translator:
    configuration:
        My\Bundle\Entity\Product:
            alias: product

            // idGetter, by default, getId
            idGetter: getId
            fields:
                name:
                    // getter, by default, getName in this case
                    // setter, by default, setName in this case
                    getter: getName
                    setter: setName
                description:
                    getter: getDescription
                    setter: setDescription
</code></pre>

<p>This is the basic definition of the Product translation. You can see that there
is come specific information set by default, so indeed, this configuration could
be defined as well that way</p>
<pre><code class="yml">elcodi_entity_translator:
    configuration:
        My\Bundle\Entity\Product:
            alias: product
            fields:
                name: ~
                description: ~
</code></pre>

<p>You can use Interfaces as well, so in that case, to ensure that the
configuration will be still valid even if you change the Product implementation,
you can use an Interface for that</p>
<pre><code class="yml">elcodi_entity_translator:
    configuration:
        My\Bundle\Entity\Interfaces\ProductInterface:
            alias: product
            fields:
                name: ~
                description: ~
</code></pre>

<h3 id="saving-translations">Saving translations</h3>
<p>Do you want to translate an entity? Great, let's do that! You can easily manage
your translation using the entity translator service.</p>
<pre><code class="php">$entityTranslator = $this
    -&gt;container
    -&gt;get('elcodi.entity_translator');
</code></pre>

<p>Once you have the service instance, you can set your entity translations in a
very simple way. In this example, let's create a new entity, let's save it into
database and let's translate it.</p>
<pre><code class="php">$product = new Product();
$product-&gt;setId(1);

$entityTranslator-&gt;save($product, array(
    'es' =&gt; array(
        'name' =&gt; 'el nombre',
        'description' =&gt; 'la descripción',
    ),
    'en' =&gt; array(
        'name' =&gt; 'the name',
        'description' =&gt; 'the description',
        'anotherfield' =&gt; 'some value',
    ),
));
</code></pre>

<h3 id="translating-an-entity">Translating an entity</h3>
<p>So, your entity is translated? Well, let's load the translations of an entity.
You only need the entity and the language you want it to be translated to.</p>
<pre><code class="php">$product = $this
    -&gt;get('doctrine.orm.entity_manager')
    -&gt;find(1);

$entityTranslator-&gt;translate($product, 'en');
</code></pre>

<p>And that's it. Your product is now translated to english, and because both
fields, name and description, are not mapped anymore, you could flush the entity
manager and no information would be saved.</p>
<h3 id="translations-in-forms">Translations in forms</h3>
<p>This is maybe the most important feature of this Bundle. How can we handle all
this stuff in our forms? Very simple. We don't have to change our form
definition but only adapt it to add an EventSubscriber.</p>
<p>Let's see an example.</p>
<pre><code class="php">use Elcodi\Component\EntityTranslator\EventListener\Traits\EntityTranslatableFormTrait;
use Symfony\Component\Form\AbstractType;

/**
 * Class ProductType
 */
class ProductType extends AbstractType
{
    use EntityTranslatableFormTrait;

    /**
     * Buildform function
     *
     * @param FormBuilderInterface $builder the formBuilder
     * @param array                $options the options for this form
     */
    public function buildForm(FormBuilderInterface $builder, array $options)
    {
        $builder
            -&gt;add('name', 'text', array(
                'required' =&gt; true,
                'label'    =&gt; 'name',
            ))
            -&gt;add('description', 'textarea', array(
                'required' =&gt; false,
                'label'    =&gt; 'description',
            ));

        $builder-&gt;addEventSubscriber($this-&gt;getEntityTranslatorFormEventListener());
    }

    /**
     * Return unique name for this form
     *
     * @return string
     */
    public function getName()
    {
        return 'form_type_product';
    }
}
</code></pre>

<p>As you can see, there are only two changes in this formType. First one is that
you must add this trait in order to add a protected variable and two methods.
The second change is that you must add the EventSubscriber the way is shown in
the example.</p>
<p>Because now the formType has some dependencies, you must define this formType as
a service in the dependency injection configuration.</p>
<pre><code class="yml">services:
    form_type.product:
        class: My\Namespace\Form\Type\ProductType
        calls:
            - [setEntityTranslatorFormEventListener, [@elcodi.entity_translator_form_event_listener]]
        tags:
            - { name: form.type, alias: form_type_product }
</code></pre>

<p>And that's it. Try to render your form, treating name and description like they
were normal fields and what you will see is that, instead of rendering a text
input field and a Textarea, three of each will be rendered.</p>
<h3 id="custom-form-views">Custom form views</h3>
<p>You can easily customize the way of rendering these fields by adding some format
into the rendering of <code>translatable_field</code>. You can find more information in
chapter - <a href="http://symfony.com/doc/current/cookbook/form/form_customization.html#what-are-form-themes">What are Form Themes?</a></p>
<h3 id="automatic-entity-translation">Automatic entity translation</h3>
<p>You can enable the automatic translation of all loaded entities by enabling the
related configuration flag <code>auto_translate</code>.</p>
<pre><code class="yml">elcodi_entity_translation:
    auto_translate: true
</code></pre>

<p>By default this value is true. If true, every time you load a new entity from
Doctrine than is defined as translatable (a field is included in the
configuration), that entity will be translated using the current locale.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>

        <!--
        MkDocs version  : 0.12.1
        Docs Build Date : 2015-04-26 15:03:56.427340
        -->
    </body>
</html>