<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://www.elcodi.io/cookbook/implementation/implement-an-event-listener/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">

        <title>Implement an event listener - Elcodi Documentation</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">

        <link href="../../../css/elcodi.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../.."><img src="../../../img/elcodi.png" height="30" /></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                
                
                
                    
                        <li >
                            <a href="../../../quick-start/">Quick start</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Book <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
<li >
    <a href="../../../book/cart-architecture/">Cart architecture</a>
</li>

                            
                                
<li >
    <a href="../../../book/category-architecture/">Category architecture</a>
</li>

                            
                                
<li >
    <a href="../../../book/coupon-architecture/">Coupon architecture</a>
</li>

                            
                                
<li >
    <a href="../../../book/dictionary/">Dictionary</a>
</li>

                            
                                
<li >
    <a href="../../../book/emails/">Emails</a>
</li>

                            
                                
<li >
    <a href="../../../book/events/">Events</a>
</li>

                            
                                
<li >
    <a href="../../../book/">Home</a>
</li>

                            
                                
<li >
    <a href="../../../book/payments/">Payments</a>
</li>

                            
                                
<li >
    <a href="../../../book/philosophy/">Philosophy</a>
</li>

                            
                                
<li >
    <a href="../../../book/plugins/">Plugins</a>
</li>

                            
                                
<li >
    <a href="../../../book/processes/">Processes</a>
</li>

                            
                                
<li >
    <a href="../../../book/product-architecture/">Product architecture</a>
</li>

                            
                                
<li >
    <a href="../../../book/pull-requests/">Pull requests</a>
</li>

                            
                                
<li >
    <a href="../../../book/roadmap/">Roadmap</a>
</li>

                            
                                
<li >
    <a href="../../../book/running-test-suite/">Running test suite</a>
</li>

                            
                                
<li >
    <a href="../../../book/shipping/">Shipping</a>
</li>

                            
                                
<li >
    <a href="../../../book/standards/">Standards</a>
</li>

                            
                                
<li >
    <a href="../../../book/templates/">Templates</a>
</li>

                            
                                
<li >
    <a href="../../../book/what-is-elcodi/">What is elcodi</a>
</li>

                            
                                
<li >
    <a href="../../../book/why-elcodi/">Why elcodi</a>
</li>

                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
<li >
    <a href="../../">Home</a>
</li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Installation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../installation/install-a-plugin/">Install a plugin</a>
</li>

        
            
<li >
    <a href="../../installation/install-dependent-bundles/">Install dependent bundles</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Overwrite</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../overwrite/overwrite-a-parameter/">Overwrite a parameter</a>
</li>

        
            
<li >
    <a href="../../overwrite/overwrite-a-service/">Overwrite a service</a>
</li>

        
            
<li >
    <a href="../../overwrite/overwrite-an-entity/">Overwrite an entity</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Deprecation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../deprecation/deprecate-a-method/">Deprecate a method</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Adapters</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../adapters/currency-rates-populator/">Currency rates populator</a>
</li>

        
            
<li >
    <a href="../../adapters/image-resize/">Image resize</a>
</li>

        
            
<li >
    <a href="../../adapters/location-provider/">Location provider</a>
</li>

        
            
<li >
    <a href="../../adapters/metrics-bucket/">Metrics bucket</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Workflow</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../workflow/create-automatic-coupon/">Create automatic coupon</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Usage</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../usage/elcodi-watermark/">Elcodi watermark</a>
</li>

        
            
<li >
    <a href="../../usage/referrer-domain/">Referrer domain</a>
</li>

        
    </ul>
  </li>

                            
                                
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Implementation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../implement-a-collector/">Implement a collector</a>
</li>

        
            
<li >
    <a href="../implement-a-controller-and-a-command/">Implement a controller and a command</a>
</li>

        
            
<li >
    <a href="../implement-a-factory/">Implement a factory</a>
</li>

        
            
<li >
    <a href="../implement-a-form-type/">Implement a form type</a>
</li>

        
            
<li >
    <a href="../implement-a-repository/">Implement a repository</a>
</li>

        
            
<li >
    <a href="../implement-an-entity/">Implement an entity</a>
</li>

        
            
<li class="active">
    <a href="./">Implement an event listener</a>
</li>

        
    </ul>
  </li>

                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Component <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
<li >
    <a href="../../../component/entity-translator/">Entity translator</a>
</li>

                            
                                
<li >
    <a href="../../../component/">Home</a>
</li>

                            
                                
<li >
    <a href="../../../component/media/">Media</a>
</li>

                            
                                
<li >
    <a href="../../../component/menu/">Menu</a>
</li>

                            
                                
<li >
    <a href="../../../component/metrics/">Metrics</a>
</li>

                            
                                
<li >
    <a href="../../../component/sitemap/">Sitemap</a>
</li>

                            
                                
<li >
    <a href="../../../component/state-transition-machine/">State transition machine</a>
</li>

                            
                                
<li >
    <a href="../../../component/template/">Template</a>
</li>

                            
                            </ul>
                        </li>
                    
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../implement-an-entity/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../../component/entity-translator/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/elcodi/docs">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#how-to-implement-an-event-listener">How to implement an Event Listener</a></li>
        
    
        <li class="main "><a href="#scenario">Scenario</a></li>
        
    
        <li class="main "><a href="#solution">Solution</a></li>
        
            <li><a href="#isolating-your-business-logic">Isolating your business logic</a></li>
        
            <li><a href="#using-dependency-injection-tags">Using Dependency Injection Tags</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="how-to-implement-an-event-listener">How to implement an Event Listener<a class="headerlink" href="#how-to-implement-an-event-listener" title="Permanent link"> #</a></h1>
<p>One of the good reasons to work with Symfony is because has a great and big
extension point. Symfony uses it's own Event Dispatcher component.</p>
<h1 id="scenario">Scenario<a class="headerlink" href="#scenario" title="Permanent link"> #</a></h1>
<p>Our project needs to grow with new features related to existing ones. Because of
Elcodi is always installed as a vendor, we should not be able to modify it at 
all. For example, each time an order is created, we should be able to send the
administrator of the website a new email.</p>
<p>We need to know how Event Listeners must be created in order to use them 
properly, using Elcodi best practices and naming conventions.</p>
<h1 id="solution">Solution<a class="headerlink" href="#solution" title="Permanent link"> #</a></h1>
<p>When we talk about Event Listeners in Symfony, we should think about a service 
with an extra layer of configuration. For example, following the example exposed
above, let's create a new service that sends that email we need.</p>
<p>Of course, this is not only a service but an EventListener, so the chosen method
must accept only one parameter. Depending of the event you want to hook your 
method, you will receive one Event type or other.</p>
<blockquote>
<p>You should know something about the Event Dispatcher from Symfony. We strongly
recommend you to read something about it before continue reading this 
documentation.</p>
</blockquote>
<p>Each type of event is associated with a different type of event instance, so you
should </p>
<pre><code class="php">use Elcodi\Component\Cart\Entity\Interfaces\OrderInterface;
use Elcodi\Component\Cart\Event\OrderOnCreatedEvent;

/**
 * This class is intended to send an Email when any order is created
 */
class OrderEmailSenderEventListener
{
    /**
     * @var string
     *
     * Address where the email has to be sent
     */
    private $email;

    /**
     * Send an email to the administrator of the website, once an Order has been
     * successfully created.
     *
     * @param OrderOnCreatedEvent $event Order on Created event
     *
     * @return $this Self object
     */
    public function sendEmail(OrderOnCreatedEvent $event)
    {
        $order = $event-&gt;getOrder();
        // Send that email using $this-&gt;email!

        return $this;
    }
}
</code></pre>

<h3 id="isolating-your-business-logic">Isolating your business logic<a class="headerlink" href="#isolating-your-business-logic" title="Permanent link"> #</a></h3>
<p>Our last implementation has one issue if you consider important your business
logic.</p>
<p>Imagine that you need to send this email from another service. Of course, this
service should know nothing about any kind of event, so, using last 
implementation, something is clearly wrong.</p>
<p>Let's see how we can fix improve this by doing just some small changes!</p>
<pre><code class="php">use Elcodi\Component\Cart\Entity\Interfaces\OrderInterface;
use Elcodi\Component\Cart\Event\OrderOnCreatedEvent;

/**
 * This class is intended to send an Email when any order is created
 */
class OrderEmailSenderEventListener
{
    /**
     * @var string
     *
     * Address where the email has to be sent
     */
    private $email;

    /**
     * Send an email to the administrator of the website, once an Order has been
     * successfully created.
     *
     * @param OrderOnCreatedEvent $event Order on Created event
     *
     * @return $this Self object
     */
    public function sendEmail(OrderOnCreatedEvent $event)
    {
        $order = $event-&gt;getOrder();
        $this-&gt;sendEmailByOrderAndEmail(
            $order,
            $this-&gt;email
        );

        return $this;
    }

     /**
      * Send an specific email given an order instance and the address where the
      * email must be sent
      *
      * @param OrderInterface $order Order
      * @param string         $email Email
      *
      * @return $this Self object
      */
    public function sendEmailByOrderAndEmail(OrderInterface $order, $email)
    {
        // Send that email using $this-&gt;email!

        return $this;
    }
}
</code></pre>

<p>With this implementation you can still be listening to the <code>order.oncreated</code>
event, and your business logic can be accessed from any point of entry.</p>
<h3 id="using-dependency-injection-tags">Using Dependency Injection Tags<a class="headerlink" href="#using-dependency-injection-tags" title="Permanent link"> #</a></h3>
<p>Once the class is created and tested, we should add this extra configuration
layer in our Dependency Injection definition. And we will do such thing by using
tags.</p>
<blockquote>
<p>Once again, this is not Elcodi related, but Symfony. You can check a little 
bit more information by checking the Symfony Docs</p>
</blockquote>
<p>Let's see an example of how this configuration could be.</p>
<pre><code class="yaml">services:

    elcodi.event_listener.order_email_sender:
        class: My\Bundle\EventListener\OrderEmailSenderEventListener
        arguments:
            - %administrator_email%
        tags:
            - { name: kernel.event_listener, event: order.oncreated, method: sendEmail }
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright © 2014/2015 <a href="http://www.elcodi.io">Elcodi</a>. All rights reserved.</p>
            
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
